# ì´ë¯¸ì§€ ì—…ë¡œë“œ ê¸°ëŠ¥ ì‘ì—… ì¤‘ ìƒê¸´ ì—¬ëŸ¬ ë¬¸ì œë“¤..
ğŸ“… 2024-05-30

<h2 id="image-is-abstract-cannot-be-instantiated">Image is abstract; cannot be instantiated</h2>
<blockquote>
<p>ì¶”ìƒí´ë˜ìŠ¤ëŠ” ì¸ìŠ¤í„´ìŠ¤í™”ê°€ ë¶ˆê°€í•˜ë‹¤!</p>
</blockquote>
<pre><code class="language-java">@Getter
// @Builder ì´ê²Œ ë¬¸ì œì˜€ìŒ!
@NoArgsConstructor(access = AccessLevel.PROTECTED)
@AllArgsConstructor
@DiscriminatorColumn
@Inheritance(strategy = InheritanceType.JOINED)
@Entity
public abstract class Image {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    protected Long id;

    protected String originalName;
    protected String storedName;
    protected String imgPath;

    private final static String[] extensionArr={&quot;jpg&quot;,&quot;jpeg&quot;,&quot;bmp&quot;,&quot;gif&quot;,&quot;png&quot;};
    public void setImgPath(String imgPath) {
        this.imgPath = imgPath;
    }

    // ì´ë¯¸ì§€ íŒŒì¼ì˜ í™•ì¥ìë¥¼ ì¶”ì¶œí•˜ëŠ” ë©”ì„œë“œ
    public String extractExtension(String originalName) {
        int index = originalName.lastIndexOf('.');
        return originalName.substring(index + 1);
    }

    // ì €ì¥í•  íŒŒì¼ ì´ë¦„ì„ ìƒì„±í•˜ëŠ” ë©”ì„œë“œ
    public String generateStoreName(String originalName) {
        String extension = extractExtension(originalName);
        if (!checkValidation(extension))
            throw new RuntimeException(extension + &quot; ì€ ì§€ì›í•˜ì§€ ì•ŠëŠ” í™•ì¥ìì…ë‹ˆë‹¤.&quot;);
        return UUID.randomUUID() + &quot;.&quot; + extension;
    }

    public boolean checkValidation(String extension) {
        return Arrays.stream(extensionArr).anyMatch(value -&gt; value.equals(extension));
    }</code></pre>
<hr />
<h2 id="reviewimgì˜-review_idê°€-nullë¡œ-ì €ì¥ë˜ë˜-ë¬¸ì œ">reviewImgì˜ review_idê°€ nullë¡œ ì €ì¥ë˜ë˜ ë¬¸ì œ</h2>
<blockquote>
<p>save()ì˜ ì˜ëª»ëœ ìœ„ì¹˜ê°€ ì›ì¸</p>
</blockquote>
<p>Review ê°ì²´ê°€ ë°ì´í„°ë² ì´ìŠ¤ì— ë¨¼ì € ì €ì¥ë˜ì–´ì•¼ reviewì˜ idê°€ í• ë‹¹ë˜ê³ , ì´í›„ì— ReviewImg ê°ì²´ë“¤ì´ í•´ë‹¹ reviewì˜ idë¥¼ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤.</p>
<pre><code class="language-java">    public Review registerReview(Long productId, ReviewRequestDto dto, List&lt;MultipartFile&gt; files) throws IOException {
        Product product = productService.findProductById(productId);
        Member member = memberService.findMemberById(dto.getMemberId());

        Review review = dto.toEntity(product, member);
        reviewRepository.save(review); // í•´ê²°

        for (MultipartFile multipartFile : files) {
            if (multipartFile != null &amp;&amp; !multipartFile.isEmpty()) {
                String originalName = multipartFile.getOriginalFilename();
                String storedName = UUID.randomUUID() + &quot;-&quot; + originalName;
                String imgPath = imgService.saveImage(multipartFile, storedName);

                ReviewImg reviewImg = ReviewImg.builder()
                        .originalName(originalName)
                        .storedName(storedName)
                        .imgPath(imgPath)
                        .review(review)
                        .build();

                review.addReviewImage(reviewImg);
                reviewImgRepository.save(reviewImg);
            }
        }

 //       reviewRepository.save(review); ì›ì¸
        return review;
    }</code></pre>
<h3 id="í•´ê²°">í•´ê²°</h3>
<p><img alt="" src="https://velog.velcdn.com/images/8w8u8/post/7f5389ad-d36f-4c14-a4f0-23d3a146c777/image.png" /></p>
<hr />
<h2 id="cascadetyperemove-vs-ondeleteaction--ondeleteactioncascade--ë¬´ì—‡ì„-ì‚¬ìš©í•´ì•¼í• ê¹Œ">CascadeType.REMOVE vs @OnDelete(action = OnDeleteAction.CASCADE) : ë¬´ì—‡ì„ ì‚¬ìš©í•´ì•¼í• ê¹Œ?</h2>
<blockquote>
<p>ë‘˜ ë‹¤ ë¶€ëª¨ ì—”í‹°í‹°ê°€ ì‚­ì œë  ë•Œ ì—°ê´€ëœ ìì‹ ì—”í‹°í‹°ë„ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ”ë°, </p>
</blockquote>
<ul>
<li><code>CascadeType.REMOVE</code>ëŠ” JPA ìˆ˜ì¤€ì—ì„œ</li>
<li><code>@OnDelete(action = OnDeleteAction.CASCADE)</code> ëŠ” ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì¤€ì—ì„œ ì²˜ë¦¬ëœë‹¤. </li>
</ul>
<h3 id="cascadetyperemove">CascadeType.REMOVE</h3>
<ul>
<li><code>CascadeType.REMOVE</code>ëŠ” <strong>JPA ìˆ˜ì¤€ì—ì„œ</strong> ë¶€ëª¨ ì—”í‹°í‹°ê°€ ì‚­ì œë  ë•Œ ì—°ê´€ëœ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì‚­ì œë˜ë„ë¡ ì„¤ì •í•œë‹¤.</li>
<li>ì¥ì <ul>
<li>ë°ì´í„°ë² ì´ìŠ¤ ë…ë¦½ì„± : ë‹¤ì–‘í•œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë™ì¼í•˜ê²Œ ë™ì‘í•˜ê³ , ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ ì‹œ ë¬¸ì œ ë°œìƒì´ ì ë‹¤.</li>
<li>JPAì—ì„œ í”„ë¡œê·¸ë¨ì ìœ¼ë¡œ ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ë¯€ë¡œ ìš´ì˜ìê°€ ì‹¤ìˆ˜ë¡œ ì˜ì¡´ì„±ì„ ê°€ì§„ ë ˆì½”ë“œë¥¼ ì‚­ì œí•˜ëŠ” ì¼ì„ ì¤„ì¼ ìˆ˜ ìˆë‹¤.</li>
</ul>
</li>
<li>ë‹¨ì <ul>
<li>ìì‹ ì—”í‹°í‹° ê°œìˆ˜ë§Œí¼ DELETE ì¿¼ë¦¬ê°€ ìƒì„±ë˜ë¯€ë¡œ ëŒ€ê·œëª¨ ë°ì´í„° ì‚­ì œ ì‹œ ì„±ëŠ¥ ë¶€ë‹´ì´ í¬ë‹¤.</li>
<li>@OneToMany ê´€ê³„ì— ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì•¼ í•˜ë¯€ë¡œ ì–‘ë°©í–¥ ì˜ì¡´ ê´€ê³„ë¥¼ ì„¤ì •í•´ì•¼ í•  ìˆ˜ ìˆë‹¤. </li>
</ul>
</li>
<li>ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œì§ì—ì„œ ì—”í‹°í‹° ìƒíƒœë¥¼ ì„¸ë°€í•˜ê²Œ ê´€ë¦¬í•´ì•¼ í•˜ëŠ” ê²½ìš° ìœ ë¦¬í•˜ë‹¤. </li>
<li>e.g. ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ì™€ ëŒ“ê¸€ì²˜ëŸ¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ì—ì„œ ì—¬ëŸ¬ ìƒíƒœ ë³€í™”ê°€ ìì£¼ ë°œìƒí•˜ëŠ” ê²½ìš°.  </li>
</ul>
<h3 id="ondeleteaction--ondeleteactioncascade">@OnDelete(action = OnDeleteAction.CASCADE)</h3>
<ul>
<li><code>@OnDelete(action = OnDeleteAction.CASCADE)</code>ëŠ” <strong>ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì¤€ì—ì„œ</strong> ë¶€ëª¨ ì—”í‹°í‹°ê°€ ì‚­ì œë  ë•Œ ì—°ê´€ëœ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì‚­ì œë˜ë„ë¡ ì„¤ì •í•œë‹¤.</li>
<li>ì¥ì <ul>
<li>ë‹¨ì¼ DELETE ì¿¼ë¦¬ë¡œ ì—°ì‡„ ì‚­ì œë¥¼ ì²˜ë¦¬í•˜ì—¬ ì„±ëŠ¥ì´ ë›°ì–´ë‚˜ë‹¤.</li>
</ul>
</li>
<li>ë‹¨ì <ul>
<li>íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì´ë©°, ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ ì‹œ ì„¤ì •ì„ ë‹¤ì‹œ í•´ì•¼í•  ìˆ˜ë„ ìˆë‹¤. </li>
</ul>
</li>
<li>ë°ì´í„°ë² ì´ìŠ¤ ì„±ëŠ¥ì´ ì¤‘ìš”í•˜ê³  ëŒ€ê·œëª¨ ë°ì´í„° ì‚­ì œ ì‘ì—…ì´ í•„ìš”í•œ ê²½ìš° ìœ ë¦¬í•˜ë‹¤.</li>
<li>e.g. ì£¼ë¬¸ê³¼ ì£¼ë¬¸ í•­ëª©ì²˜ëŸ¼ ë°ì´í„°ë² ì´ìŠ¤ ìˆ˜ì¤€ì—ì„œ ë¬´ê²°ì„±ì„ ìœ ì§€í•˜ë©´ì„œ ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì‚­ì œí•´ì•¼ í•˜ëŠ” ê²½ìš°.</li>
</ul>
<h3 id="ê·¸ë˜ì„œ-ë‚˜ëŠ”">ê·¸ë˜ì„œ ë‚˜ëŠ”...</h3>
<p>ë¦¬ë·°ì™€ ë¦¬ë·°ì´ë¯¸ì§€ ì‚¬ì´ì˜ ê´€ê³„ì—ì„œ, ë‚˜ëŠ” <code>@OnDelete(action = OnDeleteAction.CASCADE)</code> ë¥¼ ì‚¬ìš©í–ˆë‹¤.</p>
<pre><code class="language-java">@Entity
public class ReviewImg extends Image {
    // FK
    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = &quot;review_id&quot;, updatable = false)
    @OnDelete(action = OnDeleteAction.CASCADE)
    private Review review;</code></pre>
<ul>
<li>ì°¸ì¡°
<a href="https://daegwonkim.tistory.com/466">https://daegwonkim.tistory.com/466</a></li>
</ul>